<script src="../GUI-Graphs/js/go-debug.js"></script>
<link rel="import" href="../components/core-ajax/core-ajax.html">
<link rel="import" href="../components/core-drag-drop/core-drag-drop.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<polymer-element name="edit-page" attributes="pathArg1">

    <template  >
      <core-ajax 
                    id="requestDesign"
                   auto =false
                   url="/design"
                   handleAs="json"
                   response="{{res}}"
                   on-core-response="{{handleResponse}}"
                   class="">
        </core-ajax>

        <link rel="stylesheet" type="text/css" href="../stylesheets/style.css">
        <link rel="stylesheet" type="text/css" href="../GUI-Graphs/css/main.css">
        <core-ajax id="Getdevice" auto response="{{listOfdevices2}}" handleAs="json" method="GET" url="/device/" ></core-ajax>
        <core-ajax id="Getdevice" auto response="{{code}}" handleAs="json" method="GET" url="/device/" ></core-ajax>
        <div style="width:100%; white-space:nowrap;">

            <div inline flex horizontal layout style="width: 100%">

                <div id="conditionContainer" >
                    <core-drag-drop></core-drag-drop>
                    <div id="if_block" draggable="false">
                        <div class="titleCondition" style="border: 2px #E69900 solid ">IF</div>

                    </div>
                    <div id="delay_blockj" draggable="false">
                        <div class="titleCondition" style="color:#046887;border:  2px #0099CC solid;">DELAY</div>
                    </div>

                </div>
                <div id="test" style="border: solid 1px black; " inline flex  layout></div>
            </div>
            <div id="arduinoContainer" center-center layout >
                <core-drag-drop></core-drag-drop>
                <template repeat="{{device in listOfdevices2}}">

                    <div id="{{device._id}}" class="arduino" title="{{device.name}}"  draggable="false" on-drag-start="{{dragStart}}">
                        <div class=" {{device.type | changeClass}}" ></div>
                        <div>{{device.name}}</div>
                    </div>



                </template>

            </div>
        </div>
        Semantic zoom level: <input id="levelSlider" type="range" min="0" max="5" value="3">


       
        <paper-button raised  inline on-tap="{{save}}">Save</paper-button>

        <script src="../javascripts/functions.js"></script>
        
   
    </template>
<script src="../GUI-Graphs/js/editcopy.js"></script>
        

    <script>

        Polymer("edit-page", {
                    graph:null,
                    attached: function () {
                        console.log("edit page ready");
                        console.log(this.pathArg1);
                       
                        this.$.requestDesign.url="/design/"+this.pathArg1.replace(":","");
                        this.$.requestDesign.go();


                    },


                    changeClass: function(type) {

                            if (type.indexOf("o") > -1) {
                                return "arduino_output"
                            }
                            else if (type.indexOf("s") > -1) {
                                return "arduino_sensor"
                            }
                            else if (type.indexOf("w") > -1) {
                                return "arduino_switch"
                            }
                            else if (type.indexOf("b") > -1) {
                                return "arduino_button"
                            }

                            console.log(this.pathArg1);
                            document.querySelector("paper-tabs").selected = "2";

                        },
                    dragStart: function(){
                        console.log("start")

                    },
                    handleResponse:function(){
                        this.graph=getInstance();
                    
                        this.graph.init(this.res.code);
                        //init(this.res.code);
                        //load(this.res.code)

                    },
                    save:function(){

                        console.log(this.graph.getJSON());
                         this.$.requestDesign.method="PUT"
                        this.$.requestDesign.url="/design/"+this.pathArg1.replace(":","");
                        this.$.requestDesign.body=JSON.stringify({code:this.graph.getJSON()});
                        this.$.requestDesign.go();


                    }
                }


        )
    </script>

    <!--<script src="../GUI-Graphs/js/editcopy.js"></script>-->

</polymer-element>